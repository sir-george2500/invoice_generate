<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>Invoice Service - Login</title>
	<link rel="stylesheet" href="./css/styles.css">
</head>

<body>
	<div id="app-container">
		<!-- Setup Screen -->
		<div id="setup-screen" class="screen">
			<div class="setup-card">
				<div class="logo-section">
					<img src="./img/logo.png" alt="ALSM EBM Service" class="logo">
					<h2>ALSM EBM Service</h2>
					<p class="subtitle">Setup automatic EBM generation for your invoices</p>
				</div>

				<div class="setup-content">
					<div class="setup-step active" id="step-1">
						<h3>Step 1: Setup ALSM EBM Integration</h3>
						<p>This will create required custom fields and configure webhooks for automatic EBM invoice generation.</p>
						
						<div class="form-group">
							<label for="webhook-url">EBM Service URL</label>
							<input type="text" id="webhook-url" readonly value="https://ed704c2185d9.ngrok-free.app" placeholder="EBM service endpoint">
							<button type="button" class="config-btn" onclick="app.configureWebhookUrl()" style="margin-top: 8px; padding: 6px 12px; font-size: 12px;">Change URL</button>
							<small>This URL will receive your invoice data and generate EBM invoices</small>
						</div>

						<div class="setup-info">
							<h4>What will be created:</h4>
							<div class="setup-details">
								<strong>Customer Fields:</strong>
								<ul>
									<li>â€¢ Customer TIN (required)</li>
								</ul>
								<strong>Invoice Fields:</strong>
								<ul>
									<li>â€¢ Business TIN (required)</li>
									<li>â€¢ Purchase Code (required)</li>
									<li>â€¢ Organization Name</li>
									<li>â€¢ Company Address (required)</li>
									<li>â€¢ Company Email (required)</li>
								</ul>
							</div>
						</div>

						<div class="webhook-status" id="webhook-status">
							<div class="status-item">
								<span class="status-label">Custom Fields:</span>
								<span class="status-value" id="custom-fields-status">Not Created</span>
							</div>
							<div class="status-item">
								<span class="status-label">Invoice Webhook:</span>
								<span class="status-value" id="invoice-webhook-status">Not Configured</span>
							</div>
							<div class="status-item">
								<span class="status-label">Credit Note Webhook:</span>
								<span class="status-value" id="credit-webhook-status">Not Configured</span>
							</div>
						</div>

						<button type="button" class="setup-btn" id="setup-webhooks-btn">
							<span class="btn-text">Setup ALSM EBM Integration</span>
							<span class="loading-spinner" style="display: none;">âŸ³</span>
						</button>
					</div>

					<div class="setup-step" id="step-2" style="display: none;">
						<h3>Step 2: Test Connection</h3>
						<p>Let's verify the connection to the EBM service is working.</p>
						
						<div class="test-results" id="test-results" style="display: none;">
							<div class="test-item">
								<span class="test-label">EBM Service Status:</span>
								<span class="test-status" id="ebm-service-status">Testing...</span>
							</div>
						</div>

						<button type="button" class="setup-btn" id="test-connection-btn">
							<span class="btn-text">Test Connection</span>
							<span class="loading-spinner" style="display: none;">âŸ³</span>
						</button>

						<button type="button" class="setup-btn secondary" id="skip-test-btn" style="margin-left: 10px;">
							Skip Test
						</button>
					</div>

					<div class="setup-step" id="step-3" style="display: none;">
						<h3>Setup Complete!</h3>
						<p>Your ALSM EBM integration is now configured. Invoices will automatically generate EBM receipts when created.</p>
						
						<div class="setup-summary">
							<ul>
								<li>âœ… Custom fields created</li>
								<li>âœ… Webhooks configured</li>
								<li>âœ… ALSM EBM service connected</li>
								<li>âœ… Ready to generate EBM invoices</li>
							</ul>
						</div>

						<button type="button" class="setup-btn" id="complete-setup-btn">
							Start Using ALSM EBM Service
						</button>
					</div>
				</div>

				<div id="setup-error-message" class="error-message" style="display: none;"></div>
			</div>
		</div>

		<!-- Login Screen -->
		<div id="login-screen" class="screen" style="display: none;">
			<div class="login-card">
				<div class="logo-section">
					<img src="./img/logo.png" alt="ALSM EBM Service" class="logo">
					<h2>ALSM EBM Service</h2>
					<p class="subtitle">Connect to manage your EBM invoices</p>
				</div>

				<form id="login-form" class="login-form">
					<div class="form-group">
						<label for="username">Username or Email</label>
						<input type="text" id="username" name="username" placeholder="Enter your username or email" required>
					</div>

					<div class="form-group">
						<label for="password">Password</label>
						<input type="password" id="password" name="password" placeholder="Enter your password" required>
					</div>

					<div class="form-group checkbox-group">
						<input type="checkbox" id="remember-me" name="rememberMe">
						<label for="remember-me">Remember me</label>
					</div>

					<button type="submit" class="login-btn" id="login-btn">
						<span class="btn-text">Sign In</span>
						<span class="loading-spinner" style="display: none;">âŸ³</span>
					</button>

					<div class="form-links">
						<a href="#" id="forgot-password">Forgot password?</a>
					</div>
				</form>

				<div id="error-message" class="error-message" style="display: none;"></div>
			</div>
		</div>

		<!-- Main App Screen (shown after login) -->
		<div id="main-screen" class="screen" style="display: none;">
			<div class="header">
				<div class="user-info">
					<span id="user-name">Welcome!</span>
					<button id="logout-btn" class="logout-btn">Logout</button>
				</div>
			</div>
			
			<div class="content">
				<div class="tabs">
					<button class="tab-btn active" id="invoice-tab">Invoice Data</button>
					<button class="tab-btn" id="settings-tab">ALSM EBM Settings</button>
				</div>

				<div id="invoice-content" class="tab-content active">
					<h3>Current Invoice</h3>
					<div id="invoice-data" class="invoice-section">
						<!-- Invoice data will be loaded here -->
					</div>
					
					<div class="help-section" style="margin-top: 20px;">
						<button class="action-btn secondary" onclick="app.showFieldGuide()">
							ðŸ“‹ How to Fill EBM Fields
						</button>
					</div>
				</div>

				<div id="settings-content" class="tab-content">
					<h3>ALSM EBM Configuration</h3>
					<div class="settings-section">
						<div class="setting-item">
							<label>ALSM EBM Service URL:</label>
							<span class="setting-value" id="ebm-url-display">https://ed704c2185d9.ngrok-free.app</span>
						</div>
						
						<div class="setting-item">
							<label>Webhook Status:</label>
							<div class="webhook-status-list">
								<div class="webhook-item">
									<span>Invoice Webhook:</span>
									<span class="webhook-status" id="main-invoice-webhook-status">Checking...</span>
								</div>
								<div class="webhook-item">
									<span>Credit Note Webhook:</span>
									<span class="webhook-status" id="main-credit-webhook-status">Checking...</span>
								</div>
							</div>
						</div>

						<div class="setting-actions">
							<button class="action-btn" id="test-ebm-connection">Test Connection</button>
							<button class="action-btn secondary" id="reconfigure-webhooks">Reconfigure</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://js.zohostatic.com/zohofinance/v1/zf_sdk.js"></script>
	<script src="./js/extension.js" charset="utf-8"></script>

</body>

</html>
